<template>
  <div>
    <div class="header-panel w-100 flex between-xs middle-xs">
      <div class="logo pr29">
        <router-link to="/" class="no-underline">
          <svg width="110px" height="26px" class="pr2 pt2" viewBox="0 0 110 28" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <!-- Generator: Sketch 49.3 (51167) - http://www.bohemiancoding.com/sketch -->
            <desc>Created with Sketch.</desc>
            <defs />
            <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <g id="theStore" transform="translate(-340.000000, -56.000000)">
                <g id="Logo_2" transform="translate(340.000000, 46.000000)">
                  <text id="St-re" font-family="Avenir-Heavy, Avenir" font-size="37" font-weight="600" line-spacing="56" letter-spacing="-2" fill="#48475A">
                    <tspan x="25" y="37">St  </tspan>
                    <tspan x="74.535" y="37" font-size="18" />
                    <tspan x="77.863" y="37">r</tspan>
                    <tspan x="90.256" y="37">e</tspan>
                  </text>
                  <path d="M5.02462527,24.8068461 L5.62312634,24.8068461 C6.11492037,23.9253285 6.56031207,23.3013162 6.95931478,22.9347905 C7.35831748,22.5682647 7.81298817,22.3850046 8.32334047,22.3850046 C8.83369277,22.3850046 9.0888651,22.500992 9.0888651,22.7329703 C9.0888651,22.8443199 8.88936673,23.1458872 8.49036403,23.6376813 C8.09136132,24.1294753 7.78979403,24.5423905 7.5856531,24.8764393 C7.90114362,24.9135558 8.18183317,24.9460323 8.42773019,24.9738697 C8.67362721,25.0017071 8.86616633,25.0249046 9.00535332,25.0434628 C8.47644275,26.0270509 7.81299471,27.0338217 7.01498929,28.0638055 C6.75517358,28.0452472 6.53711723,28.029009 6.3608137,28.0150903 C6.18451018,28.0011716 6.00588956,27.9872531 5.82494647,27.9733344 C5.64400338,27.9594157 5.42362728,27.9431774 5.16381156,27.9246192 C4.66273839,28.7319037 4.24286393,29.4533455 3.90417559,30.0889661 C3.56548724,30.7245867 3.30567542,31.3068435 3.12473233,31.8357541 C2.94378925,32.3646646 2.85331906,32.8657303 2.85331906,33.3389661 C2.85331906,33.9792262 3.10849138,34.2993515 3.61884368,34.2993515 C3.97145073,34.2993515 4.43308066,34.1114519 5.00374732,33.735647 C5.57441399,33.3598421 6.33761121,32.7822248 7.29336188,32.0027776 L7.29336188,32.9353258 C4.78799604,35.6541117 2.93683682,37.0134843 1.73982869,37.0134843 C1.32226772,37.0134843 0.985904202,36.8511019 0.730728051,36.5263322 C0.4755519,36.2015626 0.347965739,35.7840079 0.347965739,35.2736556 C0.347965739,34.9303277 0.419877939,34.5220519 0.563704497,34.0488162 C0.707531055,33.5755804 0.965023126,32.8610979 1.33618844,31.9053472 C1.20628058,32.0166968 1.08333391,32.125725 0.967344754,32.232435 C0.851355594,32.339145 0.744647168,32.4365745 0.647216274,32.5247262 C0.54978538,32.612878 0.445396702,32.7056679 0.334047109,32.8030988 C0.222697516,32.9005297 0.111349593,33.0002789 0,33.1023494 L0,32.1419639 C0.97430894,31.3254002 2.15274112,29.8917957 3.53533191,27.8411074 C3.39614491,27.8318283 3.266239,27.824869 3.14561028,27.8202294 C3.02498155,27.8155899 2.88115715,27.8132701 2.71413276,27.8132701 C2.16666393,27.8132701 1.75838821,27.8503861 1.48929336,27.9246192 C1.37794377,27.9524566 1.27355509,27.9826133 1.1761242,28.0150903 C1.0786933,28.0475672 1.0114206,28.0638055 0.974304069,28.0638055 C0.937187537,28.0638055 0.91862955,28.0359685 0.91862955,27.9802937 C0.91862955,27.6740823 1.10884892,27.2147721 1.48929336,26.6023494 C1.79550474,26.0827179 2.08547329,25.6976397 2.35920771,25.4471031 C2.63294213,25.1965665 2.96698589,25.0272249 3.36134904,24.9390731 C3.75571218,24.8509214 4.31013204,24.8068461 5.02462527,24.8068461 Z M17.6766595,32.0306149 L17.6766595,32.9074885 C16.869375,33.7333314 16.1711307,34.4083781 15.5819058,34.9326491 C14.9926809,35.4569201 14.4776967,35.8535971 14.0369379,36.122692 C13.5961791,36.3917868 13.2226996,36.5263322 12.9164882,36.5263322 C12.1927159,36.5263322 11.8308351,36.0994985 11.8308351,35.2458183 C11.8308351,34.5591625 12.0558507,33.7634888 12.5058887,32.8587733 C12.9559266,31.9540579 13.6031364,30.8892934 14.4475375,29.6644479 C14.0299765,29.8964262 13.6356193,30.1631972 13.264454,30.4647691 C12.8932887,30.7663409 12.5638844,31.0818267 12.2762313,31.4112359 C11.9885781,31.7406451 11.7473243,32.0213346 11.5524625,32.253313 C10.9493189,32.9306896 10.3693818,33.6242944 9.81263383,34.3341481 C9.25588587,35.0440017 8.88008663,35.5056317 8.68522484,35.7190517 C8.49036305,35.9324718 8.30478318,36.0391802 8.12847966,36.0391802 C7.4047073,36.0391802 7.04282655,35.1483968 7.04282655,33.3668033 C7.04282655,32.782218 7.13097699,32.1373279 7.30728051,31.4321138 C7.48358404,30.7268997 7.95681271,29.7943609 8.72698073,28.6344693 C10.350829,26.2033365 11.7403582,24.2153121 12.8956103,22.6703365 C14.0508623,21.1253609 15.0089184,19.9562077 15.7698073,19.1628419 C16.5306962,18.369476 17.0410408,17.982078 17.3008565,18.0006363 C17.6256262,18.0284737 17.8877577,18.0934266 18.0872591,18.1954971 C18.2867605,18.2975676 18.3865096,18.413555 18.3865096,18.5434628 C18.3865096,18.7754412 18.226447,19.1581996 17.9063169,19.6917498 C17.5861868,20.2252999 17.0364065,21.0580896 16.2569593,22.1901438 C15.4125582,23.3871519 14.8140631,24.2292206 14.4614561,24.7163751 C14.1088491,25.2035295 13.5822662,25.8948145 12.8816916,26.7902509 C12.1811171,27.6856872 11.5408666,28.4836806 10.9609208,29.1842551 C10.380975,29.8848297 9.71984668,30.6433874 8.97751606,31.4599511 L8.97751606,33.1301866 C10.2209199,31.7475958 11.2972831,30.6155586 12.2066381,29.734041 C13.1159931,28.8525234 13.8861496,28.1867556 14.5171306,27.7367177 C15.1481116,27.2866797 15.6120613,27.0616641 15.9089936,27.0616641 C16.1873676,27.0616641 16.4471794,27.2263663 16.6884368,27.5557755 C16.9296943,27.8851847 17.0503212,28.1565953 17.0503212,28.3700153 C17.0503212,28.4628066 17.0039262,28.5787941 16.9111349,28.717981 C16.2430373,29.5159865 15.711815,30.1771148 15.3174518,30.7013858 C14.9230887,31.2256568 14.6192016,31.6942459 14.4057816,32.1071673 C14.1923615,32.5200887 14.0856531,32.8750103 14.0856531,33.1719425 C14.0856531,33.6080617 14.2944305,33.8261181 14.7119914,33.8261181 C15.1573898,33.8261181 16.1456026,33.227623 17.6766595,32.0306149 Z M19.9036403,32.5316855 L19.9036403,32.8796513 C19.9036403,33.4271201 20.0381857,33.8539538 20.3072805,34.1601652 C20.5763754,34.4663766 20.9289771,34.61948 21.3650964,34.61948 C21.8197739,34.61948 22.2906828,34.5127715 22.7778373,34.2993515 C23.2649917,34.0859314 23.7498191,33.8029221 24.232334,33.4503151 C24.714849,33.097708 25.304065,32.6244794 26,32.0306149 L26,32.8796513 C24.951458,34.1416133 23.9678847,35.1089484 23.0492505,35.7816855 C22.1306164,36.4544227 21.1980775,36.7907862 20.251606,36.7907862 C19.4257632,36.7907862 18.7715941,36.4706609 18.2890792,35.8304007 C17.8065643,35.1901406 17.5653105,34.3132757 17.5653105,33.1997798 C17.5653105,32.2254708 17.7926458,31.3416467 18.2473233,30.5482808 C18.7020008,29.754915 19.4443203,28.9174858 20.4743041,28.0359682 C21.1795182,27.4328246 21.8800822,26.9781539 22.5760171,26.6719425 C23.2719521,26.3657311 23.8936447,26.2126277 24.4411135,26.2126277 C24.8772327,26.2126277 25.2228752,26.3123769 25.4780514,26.5118783 C25.7332275,26.7113796 25.8608137,27.0106272 25.8608137,27.4096299 C25.8608137,27.9942152 25.6427574,28.5764721 25.2066381,29.1564179 C24.7705189,29.7363637 24.1047511,30.3116613 23.2093148,30.8823279 C22.3138785,31.4529946 21.211998,32.002775 19.9036403,32.5316855 Z M20.0428266,31.6269746 C20.8779485,31.302205 21.592431,30.8985688 22.1862955,30.4160539 C22.78016,29.9335389 23.2185924,29.471909 23.501606,29.0311502 C23.7846195,28.5903914 23.9261242,28.2679464 23.9261242,28.0638055 C23.9261242,27.8503854 23.8286948,27.743677 23.633833,27.743677 C23.4668086,27.743677 23.195398,27.8503854 22.8195931,28.0638055 C22.4437883,28.2772255 22.0633495,28.5555953 21.6782655,28.8989232 C21.2931815,29.2422511 20.947539,29.6458874 20.6413276,30.109844 C20.3351162,30.5738006 20.1356179,31.0795058 20.0428266,31.6269746 Z" id="the-copy-6" fill="#3399FF" fill-rule="evenodd" />
                  <g id="Group-8-Copy-4" stroke-width="1" fill-rule="evenodd" transform="translate(58.000000, 18.000000)">
                    <circle id="Oval-3-Copy" fill="#3399FF" cx="10" cy="10" r="10" />
                    <circle id="Oval-3-Copy-2" stroke="#FFFFFF" stroke-width="2" cx="10" cy="10" r="6" />
                  </g>
                </g>
              </g>
            </g>
          </svg>
        </router-link>
      </div>
      <div class="search-panel brdr-1 flex middle-xs px12">
        <div class="categories">
          <select class="cl-gray2 fs15 lh30 pr25 pointer">
            <option v-for="(category, index) in categories" :key="index">
              {{ getCategoryName(category) }}
            </option>
          </select>
        </div>
        <div class="mr10 ml15 cl-lightgray fs26">|</div>
        <div class="input-search w-100 flex between-xs middle-xs">
          <div class="w-75">
            <input class="fs15 weight-300 lh30 cl-silver6" type="text" v-model="search" @keyup.enter="toSearchPage" @input="makeSearch" :placeholder="getText" name="" value="">
          </div>
          <div class="cl-gray2">
            <i class="trg-icons search-ico fs16" />
          </div>
        </div>
      </div>
      <div class="account flex middle-xs pl27">
        <account-icon>
          <div v-if="!currentUser" slot="title" class="fs18 weight-900 cl-dark-blue lh20 ml5">{{ $t('Sign up/Login') }}</div>
          <div v-if="currentUser" slot="title" class="fs18 fs18 weight-900 cl-dark-blue lh20" ml5>{{ $t('Hi') }} {{ currentUser.firstname }}</div>
        </account-icon>
      </div>
      <div class="wishlist">
        <wishlist-icon />
      </div>
      <div class="cart flex middle-xs">
        <microcart-icon>
          <div slot="title" class="fs18 weight-900 cl-dark-blue lh20 ml5">{{ $t('Cart') }}</div>
        </microcart-icon>
      </div>
    </div>
  </div>
</template>

<script>
import AccountIcon from 'src/themes/trg/components/core/blocks/Header/AccountIcon.vue'
import MicrocartIcon from 'src/themes/trg/components/core/blocks/Header/MicrocartIcon.vue'
import WishlistIcon from 'src/themes/trg/components/core/blocks/Header/WishlistIcon.vue'
import i18n from 'core/lib/i18n'
import bodybuilder from 'bodybuilder'
import { categoryName } from 'core/helpers'

export default {
  name: 'HeaderPanel',
  components: {
    AccountIcon,
    MicrocartIcon,
    WishlistIcon
  },
  computed: {
    categories () {
      return this.$store.state.category.list.filter((e) => e.level === 1)
    },
    getText () {
      return i18n.t('Search for items or shops')
    },
    currentUser () {
      return this.$store.state.user.current
    }
  },
  data () {
    return {
      search: ''
    }
  },
  methods: {
    getCategoryName (category) {
      return categoryName(category)
    },
    toSearchPage () {
      let search = this.search
      if (search !== '') {
        this.$router.push({name: 'search-page', params: { searchText: search }})
      }
    },
    makeSearch () {
      let queryText = this.search
      let start = 0
      let size = 18

      let query = bodybuilder()
        .orQuery('match', 'name', { query: queryText, boost: 3 })
        .orQuery('match', 'category.name', { query: queryText, boost: 1 })
        .orQuery('match', 'short_description', { query: queryText, boost: 2 })
        .orQuery('match', 'description', { query: queryText, boost: 1 })
        .filter('range', 'visibility', { 'gte': 3, 'lte': 4 })
        .filter('range', 'price', {'gt': 1})
        .andFilter('term', 'status', '1')
        .build()

      this.$store.dispatch('product/list', {query, start, size, updateState: false}).then((resp) => {
        this.products = resp.items
        this.emptyResults = resp.items.length < 1
      }).catch(function (err) {
        console.error(err)
      })
    }
  }
}
</script>

<style lang="scss" scoped>
.header-panel {
  height: 70px;
}
.search-panel {
  box-sizing: border-box;
  flex-basis: 60%;
  height: 40px;
  border-radius: 8px;
  border-color: #CDCDCD;
  select {
    max-width: 150px;
    outline: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background: url('/assets/icons/arrow_down.svg') 100% 10px no-repeat;
    &::-ms-expand {
      display: none;
    }
  }
}
select {
  background-color: inherit;
  border: none;
}
input {
  width: 100%;
  border: none;
  outline:none;
}
.input-search input {
  font-style: oblique;
}
</style>
